---
title: "Tobin Predoctoral Data Task"
subtitle: "Experiments to Enhance the Efficiency of Medicaid"
author: "Sheena Tan"

date: today

format:
  html:
    toc: true
    toc-depth: 4
    toc-location: left
    embed-resources: true
    code-fold: false
    link-external-newwindow: true

execute:
  warning: false
  
from: markdown+emoji
reference-location: margin
citation-location: margin
---

::: {.callout-tip icon="false"}
## Github Repo Link

<https://github.com/sheena-tan/tobintask.git>
:::

# Introduction

This project uses data provided by Yale's Tobin Center for Economic Policy as part of a data task for a pre-doctoral research position. The data draws from a larger research project aiming to understand hospital response to reimbursement rate adjustment received as part of the Medicare Modernization Act (MMA) of 2003, and whether their adoption of medical technologies increased as a result of those adjustments for Task 1. Task 2 uses data... TKTK ...

## Task 1

### Exercise 1 

```{r, eval = FALSE}
skimr::skim(mma_main)
skimr::skim(mma_treat)
# check missingness: n_missing = 0 for all variables
# check duplicates: n_unique = 1305 for both datasets

# Clean primary key ----
mma_main_join <- mma_main |>
  mutate(prov_id = tolower(prov_id))

mma_treat_join <- mma_treat |>
  mutate(prov_id = tolower(prov_id))

# Join data ----
mma_data <- mma_treat_join |>
  left_join(mma_main_join)

```

An initial inspection of the data revealed no missingness. The provided data files were joined using provider ID as a primary key, resulting in a merged dataset with 13050 unique observations of 38 variables. 

### Exercise 2

```{r, eval = FALSE}
mma_data |>
  group_by(year) |>
  mutate(prov_total = n_distinct(prov_id)) |>
  skimr::skim(prov_total)
# N_t each year [2001-2010] constant = 1305

# write algorithm for tech_1
mma_saidin <- mma_data |>
  group_by(year) |>
  mutate(sum_1 = sum(tech_1)) |> #num hospitals with tech_1
  mutate(weight_1 = 1 - (1/1305) * sum_1) |> #weight a_k,t
  mutate(index_1 = tech_1 * weight_1) #intermediate value before sum

# repeat for all `tech_n`
for (i in 1:31) {
  mma_saidin <- mma_saidin |>
    group_by(year) |>
    mutate(
      !!paste0("sum_", i) := sum(!!sym(paste0("tech_", i))),
      !!paste0("weight_", i) := 1 - (1/1305) * !!sym(paste0("sum_", i)),
      !!paste0("index_", i) := !!sym(paste0("tech_", i)) * !!sym(paste0("weight_", i))
    )
}

# sum across `index_n` to find saidin index for each hospital per year
mma_saidin <- mma_saidin |>
  select(prov_id, year, starts_with("index")) |>
  pivot_longer(cols = starts_with("index"), names_to = "index") |>
  group_by(prov_id, year) |>
  summarise(sum(value)) |>
  rename(saidin = `sum(value)`)

# join to merged data
mma_data <- mma_saidin |>
  left_join(mma_data)

glimpse(mma_data)

# write out data
save(mma_data, file = here("task1/data/mma_data.rds"))
```

A variable `saidin` was constructed to represent the Saidin Index Score[^1] for all hospitals in each year and joined with the merged dataset to create the working dataset with **13050 observations** of **39 variables**. This index characterizes a hospital's range of available technologies, weighted for their rarity, and provides a way through which to investigate how hospital technology grows and changes, particularly in response to interventions.

[^1]: Spetz, J. and Bakerm, L. (1999). Has Managed Care Affected the Availability of Medical Technology? *San Francisco: Public Policy Institute of California*.

### Exercise 3

## Task 2
