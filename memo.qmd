---
title: "Tobin Predoctoral Data Task"
subtitle: "Experiments to Enhance the Efficiency of Medicaid"
author: "Sheena Tan"

date: today

format:
  html:
    toc: true
    toc-depth: 4
    toc-location: left
    embed-resources: true
    code-fold: false
    link-external-newwindow: true

execute:
  warning: false
  
from: markdown+emoji
reference-location: margin
citation-location: margin
---

::: {.callout-tip icon="false"}
## Github Repo Link

<https://github.com/sheena-tan/tobintask.git>
:::

# Introduction

This project uses data provided by Yale's Tobin Center for Economic Policy as part of a data task for a predoctoral research position. The data draws from a larger research project aiming to understand hospital response to reimbursement rate adjustment received as part of the Medicare Modernization Act (MMA) of 2003, and whether their adoption of medical technologies increased as a result of those adjustments for Task 1. Task 2 uses data... TKTK ...

## Task 1

### Exercise 1

```{r, eval = FALSE}
skimr::skim(mma_main)
skimr::skim(mma_treat)
# check missingness: n_missing = 0 for all variables
# check duplicates: n_unique = 1305 for both datasets

# Clean primary key ----
mma_main_join <- mma_main |>
  mutate(prov_id = tolower(prov_id))

mma_treat_join <- mma_treat |>
  mutate(prov_id = tolower(prov_id))

# Join data ----
mma_data <- mma_treat_join |>
  left_join(mma_main_join)

```

An initial inspection of the data revealed no missingness. The provided data files were joined using provider ID as a primary key, resulting in a merged dataset with 13050 unique observations of 38 variables.

### Exercise 2

```{r, eval = FALSE}
mma_data |>
  group_by(year) |>
  mutate(prov_total = n_distinct(prov_id)) |>
  skimr::skim(prov_total)
# N_t each year [2001-2010] constant = 1305

# algorithm for only `tech_1`
mma_saidin <- mma_data |>
  group_by(year) |>
  mutate(sum_1 = sum(tech_1)) |> #num hospitals with tech_1
  mutate(weight_1 = 1 - (1/1305) * sum_1) |> #weight a_k,t
  mutate(index_1 = tech_1 * weight_1) #intermediate value before sum

# repeat for all `tech_n`
for (i in 1:31) {
  mma_saidin <- mma_saidin |>
    group_by(year) |>
    mutate(
      !!paste0("sum_", i) := sum(!!sym(paste0("tech_", i))),
      !!paste0("weight_", i) := 1 - (1/1305) * !!sym(paste0("sum_", i)),
      !!paste0("index_",i) := !!sym(paste0("tech_",i)) * !!sym(paste0("weight_",i))
    )
}

# sum across `index_n` to find saidin index for each hospital per year
mma_saidin <- mma_saidin |>
  pivot_longer(cols = starts_with("index"), names_to = "index") |>
  group_by(prov_id, year) |>
  summarise(sum(value)) |>
  rename(saidin = `sum(value)`)

# join to merged data
mma_data <- mma_saidin |>
  left_join(mma_data)

```

A variable `saidin` was constructed to represent the Saidin Index Score[^1] for all hospitals in each year and joined with the merged dataset to create the working dataset with **13050 observations** of **39 variables**. This index characterizes a hospital's range of available technologies, weighted for their rarity, and provides a way through which to investigate how hospital technology grows and changes, particularly in response to interventions.

[^1]: Baker, L. & Spetz, J. (1999). Managed care and medical technology growth. *Frontiers in Health
Policy Research, 2*, 31.

### Exercise 3

::: {.callout-note icon="false"}
## Part A Instructions

Describe how the distribution of Saidin Index scores varies across the sample of hospitals.

:::

```{r, eval = FALSE}
mma_2004 <- mma_data |> 
  filter(year == 2004)

describe(mma_2004$saidin, IQR = TRUE, skew = FALSE)
```

```{r, echo = FALSE}
library(psych)
library(dplyr)
library(here)
load(here("task1/data/mma_data.rds"))
mma_2004 <- mma_data |> 
  filter(year == 2004)
describe(mma_2004$saidin, IQR = TRUE, skew = FALSE)
```

The distribution of Saidin Index scores in 2004 is strongly right-skewed, with values ranging from **0 to 11.57**, a **median of 1.19**, and an **IQR of 1.84**. 

![Density plot with boxplot of Saidin Index scores in 2004](task1/figures/saidin_2004.png){#fig-1}

As the Saidin Index is helpful for characterizing technology growth rates, the distributions by year can also be found below:

![Density ridge plot of Saidin Index scores by year](task1/figures/saidin_density_ridge.png){#fig-2}

![Stacked barplots of Saidin Index scores by year](task1/figures/saidin_boxplot.png){#fig-3}

Notably, a period of rapid relative growth seems to have occurred between 2002 and 2005 (@fig-3), starting in 2003 (@fig-2), the same year that the Medicare Modernization Act (MMA) was initiated. However, this rapid growth has since slowed, with growth between 2007 and 2010 becoming increasingly limited. 

It is also important to note that the scores have not shifted uniformly, rather, their distribution has become more spread out, with a large number of outliers developing on the higher end (better technology availability). Should these outliers correlate with those hospitals receiving MMA treatment, the data would suggest *support for the intervention's positive impact*. 

::: {.callout-note icon="false"}
## Part B Instructions

Looking at the Saidin Index scores youâ€™ve calculated, do different types of hospitals have different rates of technology adoption?

:::

::: {.callout-note icon="false"}
## Part C Instructions

Do hospitals with more beds tend to have higher Saidin index scores?

:::

### Exercise 4

### Exercise 5

### Exercise 6

## Task 2
